<html>
  <head>
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="./bundle.js"></script>
  </head>
  <body>
    <a-scene stats fog="type: linear; color: #a3d0ed; near: 20; far: 30"
      listen-to="target: #game-manager; event: bossStage; emit: bossStage"
      animation__near="property: fog.near; to: 40; dur: 4000; easing: linear; startEvents: bossStage"
      animation__far="property: fog.far; to: 50; dur: 4000; easing: linear; startEvents: bossStage"> <!-- fog="type: linear; color: #a3d0ed; near: 20; far: 30" -->
      
      <!-- managers -->
      <a-entity id="game-manager" game-manager
        sound__stage1="src: #stage1-theme; loop: true; on: stage1-theme-start; positional: false; volume: 0.7; autoplay: true"
        sound__boss="src: #boss-theme; loop: true; on: boss-theme-start; positional: false; volume: 0.9"></a-entity>
      <a-entity id="hardware-manager" hardware-manager></a-entity>
      <a-entity enemy-spawner listen-to="target: #game-manager; event: bossStage; emit: bossStage"></a-entity>

      <!-- assets -->
      <a-assets>
        <a-asset-item id="duck_1" src="/assets/duck_1/scene.gltf"></a-asset-item>
        <a-asset-item id="gun" src="/assets/pysics_gun_ugen/scene.gltf"></a-asset-item>
        <a-asset-item id="boss" src="/assets/rubber_duck/scene.gltf"></a-asset-item>
        <!-- songs -->
        <audio id="stage1-theme" src="/assets/audio/stage1-theme.mp3" preload="auto"></audio>
        <audio id="boss-theme" src="/assets/audio/boss-theme.mp3" preload="auto"></audio>
      </a-assets>

      <!-- templates -->
      <a-entity class="enemy_1" enemy="y: -2" follow="speed: 2; target: #rig" class="target" target="healthPoints: 1; static: false" geometry="primitive: box" gltf-model="#duck_1" scale="0.18 0.18 0.18"
        listen-to="target: #game-manager; event: bossStage; emit: die"></a-entity>
      <a-entity class="weapon-1" material="color: red; opacity: 1" geometry="primitive: icosahedron; radius: 2" scale="0 0 0" position="0 0 -20"
        animation="property: scale; to: 1 1 1; dur: 3000; easing: linear; startEvents: grow-weapon"
        listen-to="target: #boss-duck; event: weapon1shoot; emit: weapon1shoot"
        listen-to__aim="target: #boss-duck; event: leanFront; emit: aim">
      </a-entity>

      <!-- boss -->
      <!-- y: prod: -40 test: 2 -->
      <a-entity id="boss-wrapper" position="0 -40 -28"
        listen-to="target: #game-manager; event: bossEntry; emit: bossEntry"
        animation="property: object3D.position.y; to: 2; dur: 1000; easing: easeOutBack; startEvents: bossEntry">
        <a-entity id="boss-life" geometry="primitive: box; width: 20; height: 0.3; depth: 0.3" material="color: green" position="0 16 0"></a-entity>
        <a-entity boss="lookAt: #rig;">
          <a-entity id="boss-duck" rotation="30 0 0" gltf-model="#boss" scale="150 150 150"
            listen-to="target: #boss-wrapper; event: animationcomplete; emit: appear"
            listen-to__leanBack="target: #boss-duck; event: weapon1ready; emit: leanBack"
            animation__leanBack="property: rotation; to: -45 0 0; dur: 2000; easing: easeOutCubic; startEvents: leanBack"
            animation__leanFront="property: rotation; to: 30 0 0; dur: 300; easing: linear; startEvents: leanFront"
            animation__backflip="property: rotation; from: 30 0 0; to: -330 0 0; dur: 2000; easing: easeOutBack; startEvents: backflip">
            <a-entity id="boss-head" target="healthPoints: 10000; static: false; sphere: true; radius: 4" class="target" geometry="primitive: tetrahedron; radius: 0.03" material="color: red; opacity: 0" position="0 0.05 0.02"></a-entity>
            <a-entity id="boss-body" target="healthPoints: 10000; static: false; sphere: true; radius: 7" class="target" geometry="primitive: tetrahedron; radius: 0.05" material="color: red; opacity: 0"></a-entity>
          </a-entity>
        </a-entity>
      </a-entity>

      <!-- Bullet template -->
      <a-entity id="bulletTemplate" bullet="maxTime: 6; poolSize: 40; speed: 8" geometry="primitive: icosahedron; radius: 0.1" material="color: orange"></a-entity>

      <!-- plateforms -->
      <a-hexatile position="0 -25.7 0" size="3" cellsize="0.8" color="#216138" height="25"></a-hexatile>
      <a-entity class="secondary_plateforms" position="0 -40.7 0"
        listen-to="target: #game-manager; event: bossStage; emit: bossStage"
        animation="property: object3D.position.y; to: -25.7; dur: 8000; easing: linear; startEvents: bossStage">
      <!-- <a-entity class="secondary_plateforms" position="0 -25.7 0"> -->
        <a-hexatile position="-28 0 0" size="3" cellsize="0.8" color="#216138" height="25"></a-hexatile>
        <a-hexatile position="-14 0 20" size="3" cellsize="0.8" color="#216138" height="25"></a-hexatile>
        <a-hexatile position="14 0 20" size="3" cellsize="0.8" color="#216138" height="25"></a-hexatile>
        <a-hexatile position="28 0 0" size="3" cellsize="0.8" color="#216138" height="25"></a-hexatile>
      </a-entity>
      <a-ocean position="0 -1.2 0" depth="400" width="400" amplitude="0.2" amplitude-variance="0.1" opacity="1" density="50"
        listen-to="target: #game-manager; event: bossStage; emit: bossStage"
        animation="property: object3D.position.y; to: -20; dur: 4000; easing: linear; startEvents: bossStage"></a-ocean>
      <!-- <a-ocean position="0 -20 0" depth="400" width="400" amplitude="0.2" amplitude-variance="0.1" opacity="1" density="50" animation="property: object3D.position.y; to: -20; dur: 4000; easing: linear; startEvents: bossStage"></a-ocean> -->

      <!-- player -->
      <a-entity id="rig" movement-controls position="0 0 0">
        <a-entity id="camera" camera look-controls="pointerLockEnabled: true" position="0 1.7 0">
          <a-entity
            id="cursor"
            geometry="primitive: circle; radius: 0.0005"
            material="color: black"
            position="0 0 -0.1"
            cursor
            raycaster="objects: a-hexatile; far: 35; near: 10; enabled: false"
            disable-in-vr="component: geometry"
            disable-in-vr__cursor="component: cursor"
          ></a-entity>
          <a-entity id="gun" position="0.5 -0.7 -1.2" class="vr-except">
            <a-entity class="score" text="value: 0; align: center; color: purple" position="-0.022 0.11 0"></a-entity>
            <a-entity class="life" geometry="primitive: plane; height: 0.09; width: 0.025" material="color: green" rotation="-90 0 0" position="0 0.066 0.24" scale="1 1 1"></a-entity>
            <a-entity gltf-model="#gun" scale="0.15 0.15 0.15" position="0 -0.3 0.2"></a-entity>
          </a-entity>
        </a-entity>

        <!-- body -->
        <a-entity
          id="body"
          geometry="primitive: box; width: 0.1; height: 1.7; depth: 0.1"
          material="opacity: 0"
          position="0 0.85 0"
        >
        </a-entity>

        <!-- hands -->
        <a-entity id="hands" bind-rotation="target: #camera" disable-in-vr="component: bind-rotation">
          <a-entity id="left-hand"
            position="-0.3 0 -0.3"
            rotation="0 0 90"
            hand-controls="hand: left"
            laser-controls="hand: left"
            raycaster="objects: a-hexatile; far: 35; near: 10; showLine: false; lineOpacity: 0; enabled: false"
          ></a-entity>
          <a-entity id="right-hand"
            position="0.5 1.0 -1.5"
            rotation="0 0 -90"
            hand-controls="hand: right"
            shooter click-to-shoot
          >
            <a-entity class="life" geometry="primitive: plane; height: 0.09; width: 0.025" material="color: green" rotation="-90 0 0" position="0 0.065 0.04" scale="1 1 1"></a-entity> <!-- 0.05 0.1 -->
            <a-entity class="score" text="value: 0; align: left; color: purple" position="-0.045 0.052 0.79" rotation=" 0 -90 0"></a-entity>
            <a-entity gltf-model="#gun" scale="0.15 0.15 0.15" position=" 0 -0.3 0"></a-entity>
          </a-entity>
        </a-entity>
      </a-entity>
      
    </a-scene>
    <script>
    </script>
  </body>
</html>